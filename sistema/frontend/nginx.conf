# # server {
# #   listen 80;
# #   server_name localhost;

# #   root /usr/share/nginx/html;
# #   index index.html;

# #   location / {
# #     try_files $uri /index.html;
# #   }
# # }

# server {
#     listen       443 ssl http2;
#     server_name  localhost;

#     ssl_certificate      /app/cert.pem;
#     ssl_certificate_key  /app/key.pem;

#     ssl_protocols        TLSv1.2 TLSv1.3;
#     ssl_prefer_server_ciphers on;

#     # Proxy pro Vite ou build estático do front
#     location / {
#         proxy_pass         http://vue_frontend:3000;
#         proxy_http_version 1.1;
#         proxy_set_header   Host $host;
#         proxy_set_header   X-Real-IP $remote_addr;
#         proxy_set_header   Upgrade $http_upgrade;
#         proxy_set_header   Connection $http_connection;
#     }

#     # Todas as chamadas /api/* vão pro Flask
#     location /api/ {
#         proxy_pass         https://backend:5000/api/;
#         proxy_http_version 1.1;

#         proxy_ssl_server_name on;
#         proxy_ssl_verify      off;

#         proxy_set_header   Host $host;
#         proxy_set_header   X-Real-IP $remote_addr;
#         proxy_set_header   Upgrade $http_upgrade;
#         proxy_set_header   Connection $http_connection;
#     }
# }

# # opcional: redirecionar HTTP → HTTPS
# server {
#     listen      80;
#     server_name localhost;
#     return      301 https://$host$request_uri;
# }


# nginx.conf (no container do frontend)
# redireciona HTTP → HTTPS (opcional)
server {
    listen      80;
    server_name localhost;
    return      301 https://$host$request_uri;
}

# termina o TLS e serve SPA + proxy /api
server {
    listen       443 ssl http2;
    server_name  localhost;

    ssl_certificate      /etc/nginx/certs/cert.pem;
    ssl_certificate_key  /etc/nginx/certs/key.pem;

    # ========= SPA estático =========
    root   /usr/share/nginx/html;
    index  index.html;
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ========= API proxy =========
    location /api/ {
        proxy_pass         https://backend:5000/api/;
        proxy_http_version 1.1;

        # se o Flask usa self-signed mkcert:
        proxy_ssl_server_name on;
        proxy_ssl_verify      off;

        proxy_set_header Host       $host;
        proxy_set_header X-Real-IP  $remote_addr;
        proxy_set_header Upgrade    $http_upgrade;
        proxy_set_header Connection $http_connection;
    }
}

